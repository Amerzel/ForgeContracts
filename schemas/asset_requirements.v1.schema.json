{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://forge-contracts.amerzel.dev/asset_requirements.v1.schema.json",
  "title": "asset_requirements.v1",
  "description": "Declares missing or incomplete asset slots that a terrain pack needs filled. Produced by TerrainComposer, consumed by AssetGenerator.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema",
    "mapId",
    "packRef",
    "missing"
  ],
  "properties": {
    "schema": {
      "const": "asset_requirements.v1"
    },
    "mapId": {
      "type": "string",
      "minLength": 1
    },
    "packRef": {
      "type": "object",
      "description": "References the terrain pack these requirements target.",
      "additionalProperties": false,
      "required": [
        "packId",
        "version"
      ],
      "properties": {
        "packId": {
          "type": "string",
          "minLength": 1
        },
        "version": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "missing": {
      "type": "array",
      "description": "Asset slots the terrain pack is missing.",
      "items": {
        "$ref": "#/$defs/requirementItem"
      }
    },
    "producer": {
      "$ref": "#/$defs/producer"
    },
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "extensions": {
          "type": "object",
          "description": "Tool-specific extension metadata. Keyed by tool name. Consumers MUST ignore unknown keys.",
          "additionalProperties": true
        }
      }
    }
  },
  "$defs": {
    "requirementItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "kind"
      ],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "kind": {
          "type": "string",
          "enum": [
            "transition",
            "base",
            "variant",
            "stamp"
          ]
        },
        "count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of times this gap was encountered during resolution."
        },
        "suggestedVariants": {
          "type": "integer",
          "minimum": 1,
          "description": "How many visual variants the generator should produce."
        },
        "description": {
          "type": "string"
        },
        "material": {
          "type": "string",
          "description": "Source material (for base/variant requirements).",
          "pattern": "^[a-z][a-z0-9_-]*$"
        },
        "boundary": {
          "type": "array",
          "description": "Material boundary pair (for transition requirements). Alphabetical order.",
          "minItems": 2,
          "maxItems": 2,
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_-]*$"
          }
        },
        "tileSize": {
          "type": "integer",
          "minimum": 1
        },
        "transition": {
          "$ref": "#/$defs/transition"
        },
        "reference": {
          "$ref": "#/$defs/reference"
        }
      }
    },
    "transition": {
      "type": "object",
      "description": "Transition-model parameters describing the missing tile case.",
      "additionalProperties": false,
      "required": [
        "model"
      ],
      "properties": {
        "model": {
          "type": "string",
          "enum": [
            "marching-squares",
            "wang",
            "rule"
          ]
        },
        "case": {
          "type": "integer",
          "minimum": 0,
          "description": "Numeric case index (e.g. marching-squares 0-15)."
        },
        "cornerBits": {
          "type": "string",
          "description": "Binary string encoding of the case (e.g. \"0110\").",
          "pattern": "^[01]+$"
        },
        "ruleId": {
          "type": "string",
          "description": "Rule identifier (for rule-based transition models)."
        },
        "wangCode": {
          "type": "string",
          "description": "Wang tile code (for wang-based transition models)."
        },
        "transformEquivalent": {
          "type": "object",
          "description": "Indicates this case can be derived by transforming another case.",
          "additionalProperties": false,
          "required": [
            "sourceCase",
            "transform"
          ],
          "properties": {
            "sourceCase": {
              "type": "integer",
              "minimum": 0
            },
            "transform": {
              "type": "string",
              "enum": [
                "flipX",
                "flipY",
                "flipXY",
                "rot90",
                "rot180",
                "rot270"
              ]
            }
          }
        }
      }
    },
    "reference": {
      "type": "object",
      "description": "Visual reference for the asset generator (block-color preview or path to reference image).",
      "additionalProperties": false,
      "required": [
        "image"
      ],
      "properties": {
        "image": {
          "type": "string",
          "description": "Base64-encoded image data or file path to a reference image."
        },
        "colorMap": {
          "type": "object",
          "description": "Material name â†’ hex color mapping used in the reference image.",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    },
    "producer": {
      "type": "object",
      "description": "Identifies the tool that generated this document.",
      "additionalProperties": false,
      "required": [
        "tool",
        "version",
        "generatedAt"
      ],
      "properties": {
        "tool": {
          "type": "string",
          "minLength": 1
        },
        "version": {
          "type": "string",
          "minLength": 1
        },
        "generatedAt": {
          "type": "string",
          "description": "ISO 8601 timestamp of generation."
        }
      }
    }
  }
}
