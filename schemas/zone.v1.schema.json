{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://forge-contracts.amerzel.dev/zone.v1.schema.json",
  "title": "zone.v1",
  "description": "Master design document for a game zone. Drives all specialist tools in the pipeline.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema",
    "id",
    "display_name",
    "level_range"
  ],
  "properties": {
    "schema": {
      "const": "zone.v1"
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$",
      "description": "Unique zone identifier (kebab-case)"
    },
    "display_name": {
      "type": "string",
      "description": "Human-readable zone name"
    },
    "description": {
      "type": "string",
      "description": "Narrative description of the zone"
    },
    "level_range": {
      "type": "array",
      "items": { "type": "integer", "minimum": 1 },
      "minItems": 2,
      "maxItems": 2,
      "description": "Min and max player level for this zone [min, max]"
    },
    "zone_type": {
      "type": "string",
      "enum": ["overworld", "dungeon", "town"],
      "description": "Zone archetype â€” controls default map dimensions and base terrain"
    },
    "regions": {
      "type": "array",
      "items": { "$ref": "#/$defs/region" },
      "description": "Sub-regions within the zone"
    },
    "connections": {
      "type": "array",
      "items": { "$ref": "#/$defs/connection" },
      "description": "Connections to other zones at map edges"
    },
    "paths": {
      "type": "array",
      "items": { "$ref": "#/$defs/path" },
      "description": "Paths between regions and connections"
    },
    "quest_locations": {
      "type": "array",
      "items": { "$ref": "#/$defs/quest_location" },
      "description": "Quest objective anchors tied to regions"
    },
    "npcs": {
      "type": "array",
      "items": { "$ref": "#/$defs/npc_placement" },
      "description": "Named NPC placements"
    },
    "audio_hints": {
      "$ref": "#/$defs/audio_hints",
      "description": "Audio mood and ambience hints for SoundScape"
    },
    "terrain_pack_ref": {
      "type": "string",
      "description": "Reference to the terrain pack used for this zone (tc: prefix)"
    },
    "crucible_template": {
      "type": "string",
      "description": "Dot-path to the Crucible zone_design template (e.g., content.templates.zone_design.starter)"
    },
    "producer": {
      "$ref": "#/$defs/producer"
    },
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "description": {
          "type": "string"
        },
        "author": {
          "type": "string"
        },
        "extensions": {
          "type": "object",
          "description": "Tool-specific extension metadata. Keyed by tool name. Consumers MUST ignore unknown keys.",
          "additionalProperties": true
        }
      }
    }
  },
  "$defs": {
    "connection": {
      "type": "object",
      "required": ["target_zone", "edge", "type"],
      "additionalProperties": false,
      "properties": {
        "target_zone": {
          "type": "string",
          "description": "ID of the connected zone"
        },
        "edge": {
          "type": "string",
          "enum": ["north", "south", "east", "west"],
          "description": "Which map edge the connection is on"
        },
        "type": {
          "type": "string",
          "enum": ["path", "road", "cave_entrance", "portal", "gate", "bridge"],
          "description": "Type of connection"
        }
      }
    },
    "region": {
      "type": "object",
      "required": ["id", "terrain", "area_pct"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$",
          "description": "Unique region identifier within the zone"
        },
        "terrain": {
          "type": "string",
          "description": "Primary terrain/material type (maps to terrain_pack materials)"
        },
        "area_pct": {
          "type": "number",
          "minimum": 0.01,
          "maximum": 1.0,
          "description": "Approximate fraction of total zone area (0-1)"
        },
        "description": {
          "type": "string",
          "description": "Narrative description of the region"
        },
        "level_range": {
          "type": "array",
          "items": { "type": "integer", "minimum": 1 },
          "minItems": 2,
          "maxItems": 2,
          "description": "Level range override for this region"
        },
        "landmark": {
          "type": "boolean",
          "description": "If true, this region is a notable landmark placed prominently"
        },
        "entities": {
          "$ref": "#/$defs/region_entities"
        }
      }
    },
    "region_entities": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enemies": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Entity refs for enemies in this region (ea: prefix)"
        },
        "density": {
          "type": "string",
          "enum": ["none", "sparse", "standard", "dense"],
          "description": "Enemy density level"
        },
        "resource_nodes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Entity refs for resource nodes (ea: prefix)"
        }
      }
    },
    "path": {
      "type": "object",
      "required": ["from", "to", "type"],
      "additionalProperties": false,
      "properties": {
        "from": {
          "type": "string",
          "description": "Region ID or 'connections.<target_zone>' reference"
        },
        "to": {
          "type": "string",
          "description": "Region ID or 'connections.<target_zone>' reference"
        },
        "type": {
          "type": "string",
          "enum": ["road", "trail", "natural", "bridge", "tunnel"],
          "description": "Path type (affects width and rendering)"
        }
      }
    },
    "quest_location": {
      "type": "object",
      "required": ["quest_ref", "objective", "region"],
      "additionalProperties": false,
      "properties": {
        "quest_ref": {
          "type": "string",
          "description": "QuestForge artifact reference (qf: prefix)"
        },
        "objective": {
          "type": "string",
          "description": "Which quest objective this location anchors"
        },
        "region": {
          "type": "string",
          "description": "Region ID where this objective takes place"
        },
        "notes": {
          "type": "string",
          "description": "Design notes for EncounterComposer placement"
        }
      }
    },
    "npc_placement": {
      "type": "object",
      "required": ["ref", "region"],
      "additionalProperties": false,
      "properties": {
        "ref": {
          "type": "string",
          "description": "EntityArchitect NPC reference (ea: prefix)"
        },
        "region": {
          "type": "string",
          "description": "Region ID where the NPC is placed"
        },
        "placement": {
          "type": "string",
          "enum": ["fixed", "wander", "patrol"],
          "default": "fixed",
          "description": "NPC placement behavior"
        },
        "notes": {
          "type": "string",
          "description": "Placement notes"
        }
      }
    },
    "audio_hints": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "ambient": {
          "type": "string",
          "description": "Ambient audio theme"
        },
        "music_mood": {
          "type": "string",
          "description": "Music mood tag"
        },
        "combat_music": {
          "type": "string",
          "description": "Combat music tag"
        }
      }
    },
    "producer": {
      "type": "object",
      "description": "Identifies the tool that generated this document.",
      "additionalProperties": false,
      "required": [
        "tool",
        "version",
        "generatedAt"
      ],
      "properties": {
        "tool": {
          "type": "string",
          "minLength": 1
        },
        "version": {
          "type": "string",
          "minLength": 1
        },
        "generatedAt": {
          "type": "string",
          "description": "ISO 8601 timestamp of generation."
        }
      }
    }
  }
}
